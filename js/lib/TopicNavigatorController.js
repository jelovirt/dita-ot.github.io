'use strict';define(['Common','SearchView','jquery'],function(Common,SearchView,$){return function TopicNavigationController($toc,index){var common=Common(index);var view=SearchView(doQuery,common.loadMain,'tocTopicNavigator');var titles=getTitles($toc);return {activationKey:116,show:view.show};function doQuery(value){var query=buildQuery(value);console.log(titles);var results=titles.filter(query.exact);if(results.length===0){results=titles.filter(query.lax);}return results;}function buildQuery(value){var chars=value.trim().split('').map(function(c){switch(c){case '.':case '\\':case '^':case '$':case '[':case ']':case '?':case '*':case '+':return '\\'+c;case ' ':return '\\w+';default:return c;}});var _exact=new RegExp(chars.join(''),'gi');var _lax=new RegExp(chars.join('.*?'),'gi');return {exact:function exact(node){return _exact.test(node.title);},lax:function lax(node){return _lax.test(node.title);}};}function getTitles($toc){return _.keyBy($toc.find('a').map(function(){var $node=$(this);return {title:$.trim($node.text()),url:new URI($node.attr('href')).absoluteTo(index).href()};}).toArray(),function(topic){return new URI(topic.url).path();});}};});